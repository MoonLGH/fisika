<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulasi Pengereman Kendaraan (GLBB)</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --accent-color: #e74c3c;
            --bg-color: #f4f6f7;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--bg-color);
            margin: 0;
            padding: 20px;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 2fr;
            gap: 20px;
        }
        h1, h2 { color: var(--primary-color); }
        
        /* Panel Input & Info */
        .control-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .input-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input[type="number"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            width: 100%;
            cursor: pointer;
            border-radius: 4px;
            font-size: 16px;
            transition: 0.3s;
        }
        .btn:hover { background-color: #34495e; }
        
        /* Toggle Switch untuk Jalan Basah */
        .switch-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: #eef2f3;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        .toggle-checkbox {
            height: 0;
            width: 0;
            visibility: hidden;
        }
        .toggle-label {
            cursor: pointer;
            text-indent: -9999px;
            width: 50px;
            height: 25px;
            background: grey;
            display: block;
            border-radius: 100px;
            position: relative;
        }
        .toggle-label:after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 21px;
            height: 21px;
            background: #fff;
            border-radius: 90px;
            transition: 0.3s;
        }
        .toggle-checkbox:checked + .toggle-label { background: var(--accent-color); }
        .toggle-checkbox:checked + .toggle-label:after { left: calc(100% - 2px); transform: translateX(-100%); }

        /* Area Visualisasi */
        .visualization-panel {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        #animCanvas {
            width: 100%;
            height: 150px;
            background: #333; /* Warna aspal */
            border-radius: 4px;
            border-bottom: 5px dashed white; /* Marka jalan */
        }
        
        /* Hasil dan Validasi */
        .results-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        .result-box {
            background: #f8f9fa;
            padding: 10px;
            border-left: 4px solid var(--primary-color);
        }
        .result-box.validation {
            border-left-color: #27ae60;
        }
        .charts-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 20px;
        }
        
        .alert-wet {
            color: var(--accent-color);
            font-size: 0.9em;
            display: none;
            margin-top: 5px;
        }
    </style>
</head>
<body>

    <div class="container">
        <div class="control-panel">
            <h2>‚öôÔ∏è Parameter</h2>
            
            <div class="input-group">
                <label>Kecepatan Awal ($v_0$) [m/s]</label>
                <input type="number" id="v0" value="20" min="1">
            </div>

            <div class="input-group">
                <label>Perlambatan ($a$) [m/s¬≤]</label>
                <input type="number" id="acc" value="-5" max="-0.1" step="0.1">
                <small style="color: gray;">Masukkan nilai negatif (misal: -5)</small>
            </div>
            
            <div class="input-group">
                <label>Posisi Awal ($S_0$) [m]</label>
                <input type="number" id="s0" value="0" min="0">
            </div>

            <div class="switch-container">
                <span>üåßÔ∏è Mode Jalan Basah</span>
                <div>
                    <input type="checkbox" id="wetMode" class="toggle-checkbox">
                    <label for="wetMode" class="toggle-label">Toggle</label>
                </div>
            </div>
            <div id="wetAlert" class="alert-wet">
                ‚ö†Ô∏è Jalan basah mengurangi efektivitas rem sebesar 40%!
            </div>

            <button class="btn" onclick="startSimulation()">Mulai Simulasi</button>

            <div class="results-grid">
                <div class="result-box">
                    <strong>Hasil Simulasi:</strong><br>
                    Waktu: <span id="simTime">0</span> s<br>
                    Jarak Tempuh: <span id="simDist">0</span> m
                </div>
                <div class="result-box validation">
                    <strong>Validasi (Teori):</strong><br>
                    $t_{stop} = -v_0/a$: <span id="theoryTime">0</span> s<br>
                    $S_{stop} = -v_0^2/2a$: <span id="theoryDist">0</span> m
                </div>
            </div>
        </div>

        <div class="visualization-panel">
            <h2>üöó Visualisasi Pengereman</h2>
            <canvas id="animCanvas"></canvas>
            <div style="text-align: right; font-size: 0.8em; margin-top: 5px;">Skala dinamis menyesuaikan jarak henti</div>

            <div class="charts-container">
                <div>
                    <canvas id="chartVt"></canvas>
                </div>
                <div>
                    <canvas id="chartSt"></canvas>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Setup Canvas & Charts
        const canvas = document.getElementById('animCanvas');
        const ctx = canvas.getContext('2d');
        let animationFrame;
        let chartVtInstance = null;
        let chartStInstance = null;

        // Resize canvas resolution
        canvas.width = canvas.parentElement.clientWidth;
        canvas.height = 150;

        // UI Helpers
        document.getElementById('wetMode').addEventListener('change', function() {
            const alert = document.getElementById('wetAlert');
            alert.style.display = this.checked ? 'block' : 'none';
        });

        function startSimulation() {
            // 1. Ambil Input
            let v0 = parseFloat(document.getElementById('v0').value);
            let a_input = parseFloat(document.getElementById('acc').value);
            let s0 = parseFloat(document.getElementById('s0').value);
            const isWet = document.getElementById('wetMode').checked;

            // Validasi Input
            if (a_input >= 0) {
                alert("Perlambatan (a) harus bernilai negatif!");
                return;
            }

            // Logika "Nilai Tambah": Jalan Basah
            // Jika basah, efektifitas rem berkurang (a menjadi lebih dekat ke 0)
            let a = isWet ? a_input * 0.6 : a_input; 

            // 2. Hitung Validasi Teoritis (Rumus Fisika)
            // t_stop = (v_t - v_0) / a --> saat stop v_t = 0, jadi -v_0 / a
            const t_stop_theory = -v0 / a;
            // s_stop = v_0*t + 0.5*a*t^2 (Tanpa s0 untuk jarak pengereman murni)
            const stopping_distance_theory = (v0 * t_stop_theory) + (0.5 * a * t_stop_theory * t_stop_theory);
            const total_distance_theory = s0 + stopping_distance_theory;

            // Tampilkan Validasi
            document.getElementById('theoryTime').innerText = t_stop_theory.toFixed(2);
            document.getElementById('theoryDist').innerText = stopping_distance_theory.toFixed(2);

            // 3. Reset & Persiapan Animasi
            cancelAnimationFrame(animationFrame);
            let t = 0;
            const dt = 0.02; // Time step (delta t)
            let currentV = v0;
            let currentS = s0;
            
            // Scaling factor agar mobil tidak keluar layar
            // Kita beri margin 20% agar tidak mentok kanan
            const maxDisplayDist = Math.max(total_distance_theory * 1.2, 50); 
            const scalePixelsPerMeter = canvas.width / maxDisplayDist;

            // Data untuk Grafik
            let dataTime = [];
            let dataV = [];
            let dataS = [];

            // 4. Loop Animasi
            function animate() {
                // Update Fisika (Euler Integration)
                if (currentV > 0) {
                    currentS += currentV * dt;       // s = s + v*dt
                    currentV += a * dt;              // v = v + a*dt
                    t += dt;

                    // Koreksi jika berhenti (v tidak boleh negatif di rem)
                    if (currentV < 0) {
                        currentV = 0;
                        // Koreksi posisi akhir presisi
                        // currentS = s0 + stopping_distance_theory; 
                    }

                    // Push Data untuk grafik
                    dataTime.push(t.toFixed(2));
                    dataV.push(currentV.toFixed(2));
                    dataS.push(currentS.toFixed(2));

                    // Update UI Hasil Realtime
                    document.getElementById('simTime').innerText = t.toFixed(2);
                    document.getElementById('simDist').innerText = (currentS - s0).toFixed(2);
                    
                    renderCar(currentS, scalePixelsPerMeter, isWet);
                    animationFrame = requestAnimationFrame(animate);
                } else {
                    // Selesai Animasi
                    renderCar(currentS, scalePixelsPerMeter, isWet);
                    updateCharts(dataTime, dataV, dataS);
                }
            }

            // Fungsi Menggambar Mobil
            function renderCar(pos, scale, wet) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                
                // Gambar Jalan
                ctx.fillStyle = wet ? "#2c3e50" : "#333"; // Lebih biru/gelap jika basah
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                
                // Efek Basah (Pantulan/Genangan)
                if (wet) {
                    ctx.fillStyle = "rgba(255,255,255,0.1)";
                    ctx.fillRect(50, 80, 100, 20);
                    ctx.fillRect(300, 90, 80, 15);
                }

                // Posisi pixel
                const carX = pos * scale;
                const carY = canvas.height / 2 - 20;

                // Gambar Mobil
                ctx.fillStyle = "#e74c3c";
                ctx.fillRect(carX, carY, 60, 30); // Body
                ctx.fillStyle = "#ecf0f1";
                ctx.fillRect(carX + 40, carY + 5, 15, 20); // Kaca depan
                
                // Roda
                ctx.fillStyle = "black";
                ctx.beginPath();
                ctx.arc(carX + 15, carY + 30, 8, 0, Math.PI * 2);
                ctx.arc(carX + 45, carY + 30, 8, 0, Math.PI * 2);
                ctx.fill();

                // Teks Jarak di atas mobil
                ctx.fillStyle = "white";
                ctx.font = "12px Arial";
                ctx.fillText(pos.toFixed(1) + "m", carX, carY - 10);
            }

            animate();
        }

        // Fungsi Update Chart.js
        function updateCharts(labels, vData, sData) {
            // Hapus chart lama jika ada
            if (chartVtInstance) chartVtInstance.destroy();
            if (chartStInstance) chartStInstance.destroy();

            // Chart V-t
            const ctxVt = document.getElementById('chartVt').getContext('2d');
            chartVtInstance = new Chart(ctxVt, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Kecepatan (v) vs Waktu',
                        data: vData,
                        borderColor: '#e74c3c',
                        tension: 0.1,
                        pointRadius: 0
                    }]
                },
                options: { animation: false, scales: { x: {title: {display:true, text:'Waktu (s)'}}, y: {title: {display:true, text:'v (m/s)'}} } }
            });

            // Chart S-t
            const ctxSt = document.getElementById('chartSt').getContext('2d');
            chartStInstance = new Chart(ctxSt, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'Jarak (s) vs Waktu',
                        data: sData,
                        borderColor: '#3498db',
                        tension: 0.1,
                        pointRadius: 0
                    }]
                },
                options: { animation: false, scales: { x: {title: {display:true, text:'Waktu (s)'}}, y: {title: {display:true, text:'s (m)'}} } }
            });
        }
    </script>
</body>
</html>	
